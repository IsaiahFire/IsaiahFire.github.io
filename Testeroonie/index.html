<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Collage Grid</title>
    <link rel="stylesheet" href="/Testeroonie/styles.css" />
</head>
<body>
    <div class="canvas-container" id="canvasContainer">
        <div class="grid-wrapper" id="gridWrapper">
            <div class="grid" id="grid"></div>
        </div>
    </div>

    <div class="upload-modal" id="uploadModal">
        <div class="upload-content">
            <h2>Upload Image</h2>
            <div class="upload-area" id="uploadArea">
                <p>Click to select an image</p>
            </div>
            <input type="file" id="fileInput" accept="image/*">
            <div class="modal-buttons">
                <button class="cancel" id="cancelBtn">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        const grid = document.getElementById('grid');
        const gridWrapper = document.getElementById('gridWrapper');
        const canvasContainer = document.getElementById('canvasContainer');
        const uploadModal = document.getElementById('uploadModal');
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const cancelBtn = document.getElementById('cancelBtn');

        let currentSquare = null;

        let scale = 1;
        let translateX = 0;
        let translateY = 0;
        let isDragging = false;
        let startX = 0;
        let startY = 0;

        // Create 10x10 grid
        for (let i = 0; i < 100; i++) {
            const square = document.createElement('button');
            square.className = 'grid-square';
            square.addEventListener('click', (e) => {
                e.stopPropagation();
                currentSquare = square;
                uploadModal.classList.add('active');
            });
            grid.appendChild(square);
        }

        // Upload modal functionality
        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file && currentSquare) {
                // Here is where you'd send the file to your backend
                // For now, we'll just show a preview
                const reader = new FileReader();
                reader.onload = (event) => {
                    currentSquare.style.backgroundImage = `url(${event.target.result})`;
                    currentSquare.style.backgroundSize = 'cover';
                    currentSquare.style.backgroundPosition = 'center';
                    currentSquare.classList.add('filled');
                };
                reader.readAsDataURL(file);
                
                uploadModal.classList.remove('active');
                fileInput.value = '';
            }
        });

        cancelBtn.addEventListener('click', () => {
            uploadModal.classList.remove('active');
            fileInput.value = '';
        });

        // Close modal when clicking outside
        uploadModal.addEventListener('click', (e) => {
            if (e.target === uploadModal) {
                uploadModal.classList.remove('active');
                fileInput.value = '';
            }
        });

        function updateTransform() {
            gridWrapper.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
        }

        function centerGrid() {
            const containerRect = canvasContainer.getBoundingClientRect();
            const gridRect = grid.getBoundingClientRect();
            translateX = (containerRect.width - gridRect.width * scale) / 2;
            translateY = (containerRect.height - gridRect.height * scale) / 2;
            updateTransform();
        }

        // Zoom with keyboard
        document.addEventListener('keydown', (e) => {
            if (e.key === '+' || e.key === '=') {
                const containerRect = canvasContainer.getBoundingClientRect();
                const centerX = containerRect.width / 2;
                const centerY = containerRect.height / 2;
                
                const oldScale = scale;
                scale = Math.min(scale * 1.2, 5);
                
                translateX = centerX - (centerX - translateX) * (scale / oldScale);
                translateY = centerY - (centerY - translateY) * (scale / oldScale);
                
                updateTransform();
            } else if (e.key === '-') {
                const containerRect = canvasContainer.getBoundingClientRect();
                const centerX = containerRect.width / 2;
                const centerY = containerRect.height / 2;
                
                const oldScale = scale;
                scale = Math.max(scale / 1.2, 0.2);
                
                translateX = centerX - (centerX - translateX) * (scale / oldScale);
                translateY = centerY - (centerY - translateY) * (scale / oldScale);
                
                updateTransform();
            } else if (e.key === '0') {
                scale = 1;
                centerGrid();
            }
        });

        // Pan functionality
        canvasContainer.addEventListener('mousedown', (e) => {
            isDragging = true;
            startX = e.clientX - translateX;
            startY = e.clientY - translateY;
            canvasContainer.classList.add('grabbing');
        });

        document.addEventListener('mousemove', (e) => {
            if (!isDragging) return;
            translateX = e.clientX - startX;
            translateY = e.clientY - startY;
            updateTransform();
        });

        document.addEventListener('mouseup', () => {
            isDragging = false;
            canvasContainer.classList.remove('grabbing');
        });

        // Mouse wheel zoom
        canvasContainer.addEventListener('wheel', (e) => {
            e.preventDefault();
            
            const rect = canvasContainer.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;
            
            const oldScale = scale;
            
            if (e.deltaY < 0) {
                scale = Math.min(scale * 1.1, 5);
            } else {
                scale = Math.max(scale / 1.1, 0.2);
            }
            
            translateX = mouseX - (mouseX - translateX) * (scale / oldScale);
            translateY = mouseY - (mouseY - translateY) * (scale / oldScale);
            
            updateTransform();
        });

        // Initialize centered view
        centerGrid();
    </script>
</body>
</html>